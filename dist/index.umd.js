!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("path")):"function"==typeof define&&define.amd?define(["exports","path"],e):e(t.gatsbyStoryblokImage={},t.path)}(this,function(t,e){var a=/^\/\/a.storyblok.com\/f\/[0-9]+\/[0-9]+x[0-9]+\/[A-Za-z0-9]+\/[\S]+\.[a-z]+/;function i(t){var e=null,i=null;if("string"==typeof t&&(e=t),"object"==typeof t&&(e=t.image,i=t.base64?t.base64:null),!(e=a.test(e)?e:null))return!1;var n=e.replace("//a.storyblok.com/",""),s=n.split("/"),r=s[4],o=s[2].split("x").map(function(t){return parseInt(t,10)}),c=o[0],u=o[1];return{originalPath:n,extension:r.split(".")[1],metadata:{dimensions:{width:c,height:u,aspectRatio:c/u},lqip:i}}}var n="https://img2.storyblok.com",s=("default"in e?e.default:e).resolve(".cache/storyblok/assets/"),r=[1,1.5,2,3],o=[.25,.5,1,1.5,2,3],c={quality:100,smartCrop:!0,format:null,fill:null,toFormat:null,base64:null,useBase64:!0},u=Object.assign({},c,{maxWidth:800,maxHeight:null}),l=Object.assign({},c,{width:400,height:null});function p(t){var e=t.includes("filters:format(webp)"),a=/[a-f0-9]+-\d+x\d+\.webp/.test(t);return e||a}function b(t,e){return void 0===e&&(e=""),t.map(function(t){var a=t.split(" "),i=a[1];return"/static/"+i+"--"+a[0].split("/").slice(-1)+e+" "+i}).join(",\n")}function f(t,e){var a=e.width,i=e.height,s=e.smartCrop,r=e.quality,o=e.format,c=e.fill,u=t.split("."),l=n;a&&i&&(l+="/"+a+"x"+i),s&&(l+="/smart");var p=[r&&"quality:("+r+")",o&&o!==u[1]&&"format:("+o+")",c&&"fill:("+c+")"];return(p=p.filter(function(t){return!0===Boolean(t)})).length>0&&(l+=function(t){return t.reduce(function(t,e,a){return t+":"+e},"/filters")}(p)),l+"/"+t}function h(t){var a=t.imageName,i=t.src,n=t.srcWebp,r=t.srcSets;if("undefined"==typeof window){var o=require("fs-extra"),c=e.resolve(s+"/"+a);o.pathExists(c+".json").then(function(t){t||o.writeJsonSync(c+".json",{name:a,src:i,srcSet:r.base,srcWebp:n,srcSetWebp:r.webp})})}}t.getFixedGatsbyImage=function(t,e){void 0===e&&(e={});var a=i(t);if(!a)return null;var n=Object.assign({},l,e),s=n.width,o=n.height,c=a.metadata.dimensions,u=a.originalPath,d=c.aspectRatio;n.height&&(d=s/n.height);var m=null;n.toFormat?m=n.toFormat:p(u)&&(m="jpg");var g,w,v,j,x=r.map(function(t){return Math.round(s*t)}).filter(function(t){return t<c.width}).reduce(function(t,e,a){var i=r[a]+"x",s=Math.round(e/d),o=Object.assign({},n,{width:e,height:s}),c=f(u,Object.assign({},o,{format:"webp"})),l=f(u,Object.assign({},o,m&&{format:m}));return t.webp.push(c+" "+i),t.base.push(l+" "+i),t},{webp:[],base:[]}),y=Math.round(o||s/d),O=Object.assign({},n,{width:s,height:y}),S=f(u,Object.assign({},O,m&&{format:m})),W=f(u,Object.assign({},O,{format:"webp"}));if("production"===process.env.NODE_ENV&&n.saveLocal){var F=S.split(" ")[0].split("/").slice(-1);h({imageName:F,src:S,srcSets:x,srcWebp:W}),g="/static/"+F,w=b(x.base),v="/static/"+F+".webp",j=b(x.base,".webp")}else g=S,w=x.base.join(",\n")||null,v=W,j=x.webp.join(",\n")||null;return{base64:t.base64||null,aspectRatio:d,width:Math.round(s),height:y,src:g,srcSet:w,srcWebp:v,srcSetWebp:j}},t.getFluidGatsbyImage=function(t,e){void 0===e&&(e={});var a=i(t);if(!a)return null;var n=Object.assign({},u,e),s=n.maxWidth,r=a.metadata.dimensions,c=a.originalPath,l=r.aspectRatio;n.maxHeight&&(l=s/n.maxHeight);var d=n.maxHeight||Math.round(s/r.aspectRatio),m=null;n.toFormat?m=n.toFormat:p(c)&&(m="jpg");var g,w,v,j,x=n.sizes||"(max-width: "+s+"px) 100vw, "+s+"px",y=o.map(function(t){return Math.round(s*t)}).filter(function(t){return t<r.width}).concat(r.width).filter(function(t){return t<r.width}).reduce(function(t,e){var a={width:e,height:Math.round(e/l)},i=f(c,Object.assign({},n,a,{format:"webp"})),s=f(c,Object.assign({},n,a,{format:m}));return t.webp.push(i+" "+e+"w"),t.base.push(s+" "+e+"w"),t},{webp:[],base:[]}),O={width:s,height:d},S=f(c,Object.assign({},n,O,{format:m})),W=f(c,Object.assign({},n,O,{format:"webp"}));if("production"===process.env.NODE_ENV&&n.saveLocal){var F=S.split(" ")[0].split("/").slice(-1);h({imageName:F,src:S,srcSets:y,srcWebp:W}),g="/static/"+F,w=b(y.base),v="/static/"+F+".webp",j=b(y.base,".webp")}else g=S,w=y.base.join(",\n")||null,v=W,j=y.webp.join(",\n")||null;return{base64:t.base64||null,aspectRatio:l,src:g,srcSet:w,srcWebp:v,srcSetWebp:j,sizes:x}}});
//# sourceMappingURL=index.umd.js.map
